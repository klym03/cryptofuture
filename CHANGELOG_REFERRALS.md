# Changelog: –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏

## –©–æ –∑–º—ñ–Ω–∏–ª–æ—Å—è?

### ‚ùå –í–∏–¥–∞–ª–µ–Ω–æ:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∏—Ö –∫–æ–¥—ñ–≤ –ø—Ä–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
- –ö–Ω–æ–ø–∫–∞ "üîó –ú–æ—ó —Ä–µ—Ñ–µ—Ä–∞–ª–∏" –∑ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é
- –§—É–Ω–∫—Ü—ñ—è `ensure_user_referral_code()`

### ‚úÖ –î–æ–¥–∞–Ω–æ:
- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø—Ä–∏–≤'—è–∑–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —á–µ—Ä–µ–∑ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å
- –ö–æ–ª–æ–Ω–∫–∞ `owner_user_id` –≤ —Ç–∞–±–ª–∏—Ü—ñ `referral_links`
- –ö–æ–º–∞–Ω–¥–∞ `/my_referals` –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –î–≤–æ–µ—Ç–∞–ø–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω–Ω—è: –Ω–∞–∑–≤–∞ ‚Üí –≤–∏–±—ñ—Ä —Ç–∏–ø—É (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–µ/–∑–∞–≥–∞–ª—å–Ω–µ)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è

### üîÑ –ó–º—ñ–Ω–µ–Ω–æ:
- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —Ç–µ–ø–µ—Ä —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ –∞–¥–º—ñ–Ω–∞
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –æ—Ç—Ä–∏–º—É—é—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è –∑–≤–µ—Ä–Ω—É–≤—à–∏—Å—å –¥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ @nin_0009
- –õ–æ–≥—ñ–∫–∞ –ø–µ—Ä–µ–≥–ª—è–¥—É —Ä–µ—Ñ–µ—Ä–∞–ª—ñ–≤: –ø–æ–∫–∞–∑—É—î —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —î –ø—Ä–∏–≤'—è–∑–∞–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è

## –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –±–æ—Ç–∞
```bash
docker-compose restart bot
```

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
- –î–æ–¥–∞—Å—Ç—å –∫–æ–ª–æ–Ω–∫—É `owner_user_id` –¥–æ —Ç–∞–±–ª–∏—Ü—ñ `referral_links`
- –ó–∞—Å—Ç–æ—Å—É—î –≤—Å—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó

### 2. –©–æ —Å—Ç–∞–Ω–µ—Ç—å—Å—è –∑ —ñ—Å–Ω—É—é—á–∏–º–∏ –¥–∞–Ω–∏–º–∏?

- ‚úÖ –í—Å—ñ —Å—Ç–∞—Ä—ñ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –ø—Ä–æ–¥–æ–≤–∂–∞—Ç—å –ø—Ä–∞—Ü—é–≤–∞—Ç–∏
- ‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —â–æ –ø—Ä–∏–π—à–ª–∏ –∑–∞ —Å—Ç–∞—Ä–∏–º–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏ –∑–∞–ª–∏—à–∞—Ç—å—Å—è –≤ —Å–∏—Å—Ç–µ–º—ñ
- ‚ö†Ô∏è –°—Ç–∞—Ä—ñ `user_referral_code` –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –≤ –ë–î, –∞–ª–µ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è
- ‚ö†Ô∏è –©–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º—ñ–≥ –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ñ–≤ - —Å—Ç–≤–æ—Ä—ñ—Ç—å –π–æ–º—É –ø–æ—Å–∏–ª–∞–Ω–Ω—è —á–µ—Ä–µ–∑ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å

### 3. –ü–µ—Ä—à—ñ –∫—Ä–æ–∫–∏ –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

**–î–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:**
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ `/admin`
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ "üîó –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è"
3. –°–ø—Ä–æ–±—É–π—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
4. –ü—Ä–æ—Ç–µ—Å—Ç—É–π—Ç–µ –æ–±–∏–¥–≤–∞ —Ç–∏–ø–∏: –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–µ —Ç–∞ –∑–∞–≥–∞–ª—å–Ω–µ

**–î–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:**
1. –í—ñ–¥–ø—Ä–∞–≤—Ç–µ `/my_referals`
2. –Ø–∫—â–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–µ–º–∞—î - –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ @nin_0009
3. –ü—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω–Ω—è - –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–Ω–æ–≤—É

## –¢–µ—Ö–Ω—ñ—á–Ω—ñ –∑–º—ñ–Ω–∏

### –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö

**–ù–æ–≤—ñ –∫–æ–ª–æ–Ω–∫–∏:**
```sql
ALTER TABLE referral_links ADD COLUMN owner_user_id BIGINT;
```

**–û–Ω–æ–≤–ª–µ–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó:**
- `create_referral_link()` - —Ç–µ–ø–µ—Ä –ø—Ä–∏–π–º–∞—î `owner_user_id`
- `get_user_referral_stats()` - —Ç–µ–ø–µ—Ä –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ `referral_links.owner_user_id`
- `get_user_referrals()` - —à—É–∫–∞—î —á–µ—Ä–µ–∑ `referral_links.owner_user_id`
- `get_user_by_referral_code()` - –ø–µ—Ä–µ–≤—ñ—Ä—è—î `referral_links` –∑–∞–º—ñ—Å—Ç—å `users`

### Handlers

**–ó–º—ñ–Ω–µ–Ω—ñ:**
- `cmd_referrals` ‚Üí `cmd_my_referrals` (–∫–æ–º–∞–Ω–¥–∞ –∑–∞–º—ñ—Å—Ç—å –∫–Ω–æ–ø–∫–∏)
- `process_create_referral` - —Ç–µ–ø–µ—Ä –¥–≤–æ–µ—Ç–∞–ø–Ω–∏–π –ø—Ä–æ—Ü–µ—Å
- `register_user_handlers` - –≤–∏–¥–∞–ª–µ–Ω–æ –∫–Ω–æ–ø–∫—É, –¥–æ–¥–∞–Ω–æ –∫–æ–º–∞–Ω–¥—É

**–î–æ–¥–∞–Ω—ñ:**
- `callback_ref_bind_user` - –≤–∏–±—ñ—Ä –ø—Ä–∏–≤'—è–∑–∫–∏ –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- `callback_ref_no_bind` - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
- `process_referral_owner` - –æ–±—Ä–æ–±–∫–∞ –≤–∏–±–æ—Ä—É –≤–ª–∞—Å–Ω–∏–∫–∞

### States

**–î–æ–¥–∞–Ω–æ:**
- `AdminStates.waiting_for_referral_owner` - –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≤–∏–±–æ—Ä—É –≤–ª–∞—Å–Ω–∏–∫–∞

## –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è

```
–ê–¥–º—ñ–Ω: /admin ‚Üí –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è ‚Üí –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
–ê–¥–º—ñ–Ω: –≤–≤–æ–¥–∏—Ç—å "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ"
–ë–æ—Ç: –û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –ø–æ—Å–∏–ª–∞–Ω–Ω—è [–ü—Ä–∏–≤'—è–∑–∞—Ç–∏ –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞] [–ó–≤–∏—á–∞–π–Ω–µ]
–ê–¥–º—ñ–Ω: –Ω–∞—Ç–∏—Å–∫–∞—î "–ü—Ä–∏–≤'—è–∑–∞—Ç–∏ –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞"
–ë–æ—Ç: –í–≤–µ–¥—ñ—Ç—å username –∞–±–æ user_id
–ê–¥–º—ñ–Ω: –≤–≤–æ–¥–∏—Ç—å "ivanpetro"
–ë–æ—Ç: ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–æ!
     –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—Ç—Ä–∏–º–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
```

### –ü–µ—Ä–µ–≥–ª—è–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º

```
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: /my_referals

–Ø–∫—â–æ —î –ø–æ—Å–∏–ª–∞–Ω–Ω—è:
–ë–æ—Ç: üîó –í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞
     üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: 5 —Ä–µ—Ñ–µ—Ä–∞–ª—ñ–≤, 2 –∑ –ø—ñ–¥–ø–∏—Å–∫–æ—é
     üåê –í–∞—à–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è: ...

–Ø–∫—â–æ –Ω–µ–º–∞—î:
–ë–æ—Ç: ‚ùå –£ –≤–∞—Å —â–µ –Ω–µ–º–∞—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è
     üí° –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ @nin_0009
```

## Troubleshooting

### –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –±–∞—á–∏—Ç—å —Å–≤–æ—ó—Ö —Ä–µ—Ñ–µ—Ä–∞–ª—ñ–≤
**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–µ –ø—Ä–∏–≤'—è–∑–∞–Ω–µ –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞  
**–†—ñ—à–µ–Ω–Ω—è:** –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —á–µ—Ä–µ–∑ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å –∑ –ø—Ä–∏–≤'—è–∑–∫–æ—é

### –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π  
**–†—ñ—à–µ–Ω–Ω—è:** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ username –∞–±–æ user_id, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –±—É—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—ñ

### –°—Ç–∞—Ä—ñ —Ä–µ—Ñ–µ—Ä–∞–ª–∏ –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è
**–ü—Ä–∏—á–∏–Ω–∞:** –í–æ–Ω–∏ –±—É–ª–∏ –∑–∞ —Å—Ç–∞—Ä–æ—é —Å–∏—Å—Ç–µ–º–æ—é –±–µ–∑ –ø—Ä–∏–≤'—è–∑–∫–∏  
**–†—ñ—à–µ–Ω–Ω—è:** –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è, —Å—Ç–∞—Ä—ñ –¥–∞–Ω—ñ –∑–∞–ª–∏—à–∞—Ç—å—Å—è –≤ –ë–î

## Rollback

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ —Å—Ç–∞—Ä–æ—ó –≤–µ—Ä—Å—ñ—ó:

```bash
# –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –≤–µ—Ä—Å—ñ—ó —Ñ–∞–π–ª—ñ–≤
git checkout HEAD~1 db/queries.py
git checkout HEAD~1 bot/handlers/user_handlers.py
git checkout HEAD~1 bot/handlers/admin_handlers.py
git checkout HEAD~1 bot/keyboards/reply.py
git checkout HEAD~1 bot/states/__init__.py

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ –±–æ—Ç–∞
docker-compose restart bot
```

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** –ö–æ–ª–æ–Ω–∫–∞ `owner_user_id` –∑–∞–ª–∏—à–∏—Ç—å—Å—è –≤ –ë–î, –∞–ª–µ –Ω–µ –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è.

## –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–ü—Ä–∏ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—ñ –ø—Ä–æ–±–ª–µ–º:
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏: `docker-compose logs -f bot`
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ë–î: `docker-compose exec postgres psql -U patrick -d casino`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –±–æ—Ç–∞: `docker-compose restart bot`

---

**–í–µ—Ä—Å—ñ—è:** 2.0  
**–î–∞—Ç–∞:** 18.10.2025  
**–ê–≤—Ç–æ—Ä:** –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏

